<!DOCTYPE html>
<html>
    <head>
        <title>CTP : Asynchronous Messaging - Tool Evaluation</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">CTP</a></span>
                            </li>
                                                    <li>
                                <span><a href="Connected-Technology-Platform---HOME_106337033.html">Connected Technology Platform - HOME</a></span>
                            </li>
                                                    <li>
                                <span><a href="Knowledge-Base_106337044.html">Knowledge Base</a></span>
                            </li>
                                                    <li>
                                <span><a href="Design_106337061.html">Design</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            CTP : Asynchronous Messaging - Tool Evaluation
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Lakshminarayanan Mukundagiri (TMNA)</span>, last modified by <span class='editor'> Navin Chaudhary (TMNA)</span> on May 23, 2018
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>The very need to explore the Asynchronous messaging solution was to provide a composite solution for the suite of Registration apps in streaming and exchanging feed data.</p><p><strong>Problem Statement - SMEs - </strong>Vineet Kamdar; Srinivasan YegnoNarayanan</p><p><span>From the messaging system perspective, we need to choose the tool that provides us following abilities: (<u>For registration Apps</u> - Vehicle, Account and Subscription Management)</span></p><p><span> </span><br/><span>a. Encryption/Decryption - As discussed in the group earlier, this feature will not be provided by the messaging system, but needs to be a custom solution by the development team on top of the messaging system</span><br/><span>b. Ability to retain messages</span><br/><span>c. Ability to trigger certain messages again based on filter criteria such as time, message type etc.</span><br/><span>d. Better reliability of messages</span><br/><span>e. Ability to mark/manage messages as read, in case there are multiple listeners. This is to ensure that multiple listeners do not read and process the same message again.</span><br/><span>f. Ability to orchestrate the messages or have some intelligence to identify what message goes to what all consumers.</span><br/><u>For e.g.: Message 1 has to be sent to Consumer 1, Consumer 2 and Consumer 3   Vs  Message 2 has to be sent only to Consumer 2 and Consumer 3 and similar such scenarios</u></p><p><span><br/></span></p><p><strong>Solution Analysis for Choice of Outcome</strong></p><p>The following are some of the industry standards messaging Queue solutions compatible for Cloud stack which were explored to derive the choice of outcome requested for comparison.</p><p>1. Rabbit MQ<br/>2. Kafka<br/>3. Kinesis<br/>4. SQS</p><p> </p><p><strong>Analysis</strong></p><p><strong><br/></strong></p><p><u><strong>Messaging Technologies (Kafka vs Kinesis vs SQS vs RabbitMQ)</strong></u></p><p> </p><p>Each messaging tool has its own origin story, design intent, uses cases where it shines, integration capabilities and developer experience. For example, Kafka excels in the “event store/event sourcing”. This comparison mainly compares the overlapping use case of the message broker.</p><p> </p><p><strong>Key Decision Factors</strong></p><ol><li>Operational costs</li><li>Scalability</li><li>Monitoring</li></ol><p> </p><p><u><strong>Origins </strong></u></p><p> </p><p><strong>Kafka</strong></p><ul><li>Developed in Scala and started out at LinkedIn.</li><li>More focused on the distributed architecture with data integration and real-time stream processing, breaking away from previously monolithic approach based solutions.</li><li>Well adopted within the Apache Software Foundation ecosystem of products and is particularly useful in event-driven architecture.<br/><br/></li></ul><p><strong>Kinesis </strong></p><ul><li>Part of Kinesis streaming data platform. It is not just a messaging technology but a complete solution.</li><li>Very well integrates with AWS</li><li>Offered by AWS as a managed service, a viable alternative to Kafka<br/><br/><br/></li></ul><p><strong>SQS</strong></p><ul><li>Simple Queue Service</li><li>Offered by AWS as a managed service</li></ul><p> </p><p><strong>RabbitMQ </strong></p><ul><li>Open source, traditional message broker that implements a variety of messaging protocols.</li><li>Reasonable level of features, client libraries, dev tools and good documentation.</li></ul><p> </p><p>  </p><p><strong><u>Architecture and Design</u></strong></p><p><strong> </strong></p><p><strong>Kafka</strong></p><ul><li>Open source</li><li>Kafka is a <strong>fast, scalable, durable, and fault-tolerant publish-subscribe messaging system</strong>, which is often used in place of traditional message brokers like JMS and AMQP (Advanced message queuing protocol - used by RabbitMQ) because of its characteristics like higher throughput, reliability, and replication</li><li>Supports asynchronous</li><li>Designed for <strong>high volume </strong>publish-subscribe messages and streams, meant to be durable, fast, and scalable.</li><li><strong>Kafka provides a durable message store, similar to a log</strong>, run in a server cluster, that stores streams of records in categories called topics.</li><li>Every message consists of a key, a value, and a timestamp.</li><li>Nearly the opposite of RabbitMQ, Kafka employs a dumb broker and uses smart consumers to read its buffer.</li><li>Kafka does not attempt to track which messages were read by each consumer and only retain unread messages; rather, Kafka retains all messages for a set amount of time, and consumers are responsible to track their location in each log (consumer state).</li><li>With the right developer talent creating the consumer code, Kafka can support a large number of consumers and retain large amounts of data with very little overhead.</li><li>Kafka does require external services to run - in this case, <strong>Apache Zookeeper</strong>, which is often regarded as non-trivial to understand, setup and operate.</li></ul><p> </p><p>Kafka basic terminology</p><ul><li>Topics – All Kafka messages are organized into topics.</li><li>Message – Each message in a Kafka cluster can be uniquely identified by a tuple consisting of the <strong>message’s topic, partition and offset</strong> within the partition.</li><li> Offset - Each message within a partition has an identifier called its offset. The offset is the ordering of messages and is an immutable sequence. Kafka maintains this message ordering Consumers can read messages starting from a specific offset and are allowed to read from offset point they choose, allowing consumers to join the cluster at any point in time. </li><li>Producers</li><li>Consumers</li><li>Brokers – Each node in the cluster is a called a Kafka broker</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/107086458/107088844.png" data-image-src="attachments/107086458/107088844.png" data-unresolved-comment-count="0" data-linked-resource-id="107088844" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2018-5-9 16:11:21.png" data-base-url="https://confluence.sdlc.toyota.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="107086458" data-linked-resource-container-version="9"></span></p><p> </p><p><strong>RabbitMQ </strong></p><ul><li>Open source</li><li><strong>General purpose message broker</strong>, employing several variations of point to point, request/reply and pub-sub communication styles patterns.</li><li>Uses a smart broker / dumb consumer model, focused on consistent delivery of messages to consumers that consume at a roughly similar pace as the broker keeps track of the consumer state.</li><li>It is mature, performs well when configured correctly, is well supported (client libraries Java, .NET, node.js, Ruby, PHP and many more languages)</li><li>Has dozens of plugins available that extend it to more use cases and integration scenarios.</li><li>Communication in RabbitMQ <strong>can be either synchronous or asynchronous</strong> as needed.</li><li>Publishers send messages to exchanges, and consumers retrieve messages from queues.</li><li>RabbitMQ also offers a number of distributed deployment scenarios (and does require all nodes be able to resolve hostnames). It can be setup for multi-node clusters to cluster federation and does not have dependencies on external services (but some cluster formation plugins can use AWS APIs, DNS, Consul, etcd). </li><li>RabbitMQ can also effectively address several of Kafka’s strong uses cases above, <strong>but with the help of additional software.</strong></li></ul><p><strong>Kinesis</strong></p><ul><li>Real-time stream that allows processing data posted with minimal delay.</li><li>Another service offered by AWS that makes it easy to load and analyze streaming data</li><li>Also provides the ability to build custom streaming data applications for special requirements.</li><li>Amazon Kinesis is currently broken into three separate service offerings<br/><strong>1)</strong> <strong>Kinesis Streams</strong> - Kinesis Streams is capable of capturing large amounts of data (terabytes per hour) from data producers, and streaming it into custom applications for data processing and analysis.<br/><strong>2) Kinesis Firehose</strong> -  It is used to capture and load streaming data into other Amazon services such as S3 and Redshift. From there, you can load the streams into data processing and analysis tools like Elastic Map Reduce, and Amazon Elasticsearch Service. <br/><strong>3) Kinesis Analytics</strong> - It allows running of standard SQL queries against data streams, and send that data to analytics tools for monitoring and alerting</li></ul><p> </p><p><strong>SQS</strong></p><ul><li>FIFO queue based</li><li>Can be combined with SNS to create a more custom messaging platform</li></ul><p> </p><p> </p><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 96.9569%;"><colgroup><col style="width: 13.7871%;"/><col style="width: 23.9965%;"/><col style="width: 20.2443%;"/><col style="width: 19.808%;"/><col style="width: 22.164%;"/></colgroup><tbody><tr><td class="confluenceTd"><p><strong>Features</strong></p></td><td class="confluenceTd"><p><strong>Kafka</strong></p></td><td class="confluenceTd"><p><strong>Kinesis</strong></p></td><td class="confluenceTd"><p><strong>SQS</strong></p></td><td class="confluenceTd"><p><strong>RabbitMQ</strong></p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Supports multiple consumers of the same message or same consumer at different times</p></td><td style="text-align: left;" class="confluenceTd"><p>Yes</p></td><td style="text-align: left;" class="confluenceTd"><p>Yes (Replay-able queue)</p></td><td style="text-align: left;" class="confluenceTd"><p>No</p></td><td style="text-align: left;" class="confluenceTd"><p>No. Multiple queues need to be created</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Speed</p></td><td style="text-align: left;" class="confluenceTd"><p><strong>-</strong>Easy to setup, maintenance, and use</p><p><strong>-</strong>Blazing fast performance.</p><p><strong>-</strong>Input rate Tens of MB/sec on Kafka.</p><p>- Publish-subscribe messaging model</p></td><td style="text-align: left;" class="confluenceTd"><p>- One click setup, since it is managed by AWS</p><p>- Writes few ms slower compared to Kafka (maybe because it replicates across 3 AZs)</p><p><strong>-Input rate 1MB/sec</strong> max input rate</p></td><td style="text-align: left;" class="confluenceTd"><p>- Fully managed and scalable queuing service on AWS</p><p>- Easy to use</p><p>- Good performance, with great scalability characteristics</p></td><td style="text-align: left;" class="confluenceTd"><p>- Easy to setup, maintenance, and use</p><p>- Fast performance</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Encryption/Decryption</p></td><td style="text-align: left;" class="confluenceTd"><p>Kafka uses TLS for client and internode communications</p></td><td style="text-align: left;" class="confluenceTd"><p>AWS Key Managed Service (KMS)</p></td><td style="text-align: left;" class="confluenceTd"><p>AWS Key Managed Service (KMS)</p></td><td style="text-align: left;" class="confluenceTd"><p>TLS for client and internode communications</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Retain messages</p></td><td style="text-align: left;" class="confluenceTd"><p>Kafka cluster retains all published messages—whether or not they have been consumed—for a configurable period of time. For example, if the log retention is set to two days, then for the two days after a message is published it is available for consumption, after which it will be discarded to free up space. Messages can be retained for as long as you like(storage space needed)</p></td><td style="text-align: left;" class="confluenceTd"><p>-Kinesis by default holds data for just 24 hours. You need to pay more for retaining data over a longer period (7 days maximum)</p></td><td style="text-align: left;" class="confluenceTd"><p>SQS destroys the message once it is processed from its queue               - Default message retention period for an SQS queue is four days, (Configurable 1 minute to 14 days)</p></td><td style="text-align: left;" class="confluenceTd"><p>Flexible with setting retention period from milliseconds to an indefinite time (half billion years)</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Trigger certain messages again based on filter criteria such as time, message time etc.</p></td><td style="text-align: left;" class="confluenceTd"><p>N/A</p></td><td style="text-align: left;" class="confluenceTd"><p>N/A</p></td><td style="text-align: left;" class="confluenceTd"><p>N/A</p></td><td style="text-align: left;" class="confluenceTd"><p>N/A</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Reliability of messages</p></td><td style="text-align: left;" class="confluenceTd"><p>Super reliable if configured properly</p></td><td style="text-align: left;" class="confluenceTd"><p>Reliable</p></td><td style="text-align: left;" class="confluenceTd"><p>Reliable</p></td><td style="text-align: left;" class="confluenceTd"><p>Reliable</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Ability to mark/manage messages as read, in case there are multiple listeners.</p></td><td style="text-align: left;" class="confluenceTd"><p>Yes. Multiple consumers will read a message from different partition depending on GroupID configuration</p></td><td style="text-align: left;" class="confluenceTd"><p>Yes. Multiple consumers can read from the same stream</p></td><td style="text-align: left;" class="confluenceTd"><p>No. Multiple queues need to be created to achieve it.</p></td><td style="text-align: left;" class="confluenceTd"><p>No. Multiple queues need to be created</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Ability to orchestrate the messages or have some intelligence to identify what message goes to what all consumers.</p></td><td style="text-align: left;" class="confluenceTd"><p>N/A</p></td><td style="text-align: left;" class="confluenceTd"><p>N/A</p></td><td style="text-align: left;" class="confluenceTd"><p>N/A</p></td><td style="text-align: left;" class="confluenceTd"><p>N/A</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>Cost</p></td><td style="text-align: left;" class="confluenceTd"><p>-Software is free for commercial use</p><p>-Also offered as SaaS by confluent</p><p>-Hardware costs</p><p>-Operational costs</p></td><td style="text-align: left;" class="confluenceTd"><p>-Pay as you go pricing</p><p>-Shard is the base throughput unit of an amazon kinesis stream</p><p>- 1 Shard = 1MB/sec data input and 2MB/sec data output</p><p>-One shard can support up to 1000 records per second</p><p>- You specify the number of shards needed within your stream based on your throughput requirements. You are charged for each shard at an hourly rate.</p></td><td style="text-align: left;" class="confluenceTd"><p>-Cheap but gets expensive when sending large volumes of data for a long time. After some time it is worth considering a dedicated broker like Kafka</p><p>- 1 million Amazon SQS requests for free each month</p><p>Standard Queue</p><p>$0.40 ($0.00000040 per request)</p><p>FIFO Queue</p><p>$0.50 ($0.00000050 per request)</p></td><td style="text-align: left;" class="confluenceTd"><p>-Software is free for commercial use</p><p>- Support based model from Pivotal</p><p>-Hardware costs</p><p>-Operational costs</p></td></tr></tbody></table></div><p> </p><p><u><strong>Kinesis Cost/Rough estimate</strong></u></p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/107086458/107088847.png" data-image-src="attachments/107086458/107088847.png" data-unresolved-comment-count="0" data-linked-resource-id="107088847" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2018-5-9 16:11:45.png" data-base-url="https://confluence.sdlc.toyota.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="107086458" data-linked-resource-container-version="9"></span></p><p> </p><p> </p><p><u><strong>Kafka/Rough estimate</strong></u></p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/107086458/107088848.png" data-image-src="attachments/107086458/107088848.png" data-unresolved-comment-count="0" data-linked-resource-id="107088848" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2018-5-9 16:11:53.png" data-base-url="https://confluence.sdlc.toyota.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="107086458" data-linked-resource-container-version="9"></span></p><p> </p><p> </p><p><strong>Main things to consider for any messaging solution:</strong>       </p><ul><li>On-prem vs Open Source vs SaaS solution</li><li>Daily GBs consumed and required data retention (Main pricing component)</li><li>Which and how many services you’d like to connect</li><li>Users, are they all developers?</li><li>Specific use cases</li><li>The rate of expected changes to your dashboards</li></ul><p> </p><p><strong><br/></strong></p><p><strong><br/></strong></p><p><strong>Contributor - Navin Chaudhary</strong></p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/107086458/107088844.png">image2018-5-9 16:11:21.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/107086458/107088847.png">image2018-5-9 16:11:45.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/107086458/107088848.png">image2018-5-9 16:11:53.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="comments" class="pageSectionTitle">Comments:</h2>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-107089559"></a>
                                    <font class="smallfont"><p>Overall Nice summary of features with cover of main things to consider - Going with AWS Native Kinesis must suffice the needful unless there is a business critical use case justifying for Kafka (Specifically around retaining Published messages more than 24 hours) </p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/contenttypes/comment_16.png" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by 418023 at May 10, 2018 14:15
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    </div>
                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Nov 07, 2018 23:41</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
